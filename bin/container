#!/usr/bin/env bash
set -euo pipefail

case "$1" in
  reset)
    docker-compose down --volumes
    rm -rf plugins/*
  ;;
  recreate)
    docker-compose up -d db
    while true; do
      docker-compose up --force-recreate wordpress || true
      sleep 0.2
    done
  ;;
  shell)
    while true; do
      docker-compose exec wordpress bash || true
      sleep 0.2
    done
  ;;
  sync)
    DIR=$(pwd)
    cd "$2"
      rsync -avh --delete . "$DIR/plugins/dev"
      reflex -- rsync -avh --delete . "$DIR/plugins/dev"
  ;;
esac